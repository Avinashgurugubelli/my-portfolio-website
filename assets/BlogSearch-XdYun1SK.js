import{u as w,j as e,B as C,S as b,I as S,C as B,b as I,F as E,c as L,d as T,e as k,f as A,r as p,a3 as R,A as P,m as $,N as F,i as D}from"./index-Cv8_xXqY.js";import{A as U,C as q}from"./calendar-BraVFBcE.js";import{B as H,U as O,T as _}from"./TagsDisplay-BM1nHQk8.js";import{B as N}from"./blogService-DqrvHuYA.js";const z=({searchQuery:t,onSearchChange:n})=>{const s=w();return e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs(C,{variant:"outline",size:"sm",onClick:()=>s("/blogs"),className:"gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),"Back to Blogs"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Search Blogs"}),e.jsx("p",{className:"text-muted-foreground",children:"Find articles by title, content, tags, or author"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(b,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(S,{type:"text",placeholder:"Search articles...",value:t,onChange:o=>n(o.target.value),className:"pl-10 h-12 text-lg",autoFocus:!0})]})]})},M=({result:t,searchQuery:n,index:s,onClick:o})=>{const x=(l,a)=>{if(!a.trim())return l;const r=new RegExp(`(${a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");return l.split(r).map((m,c)=>r.test(m)?e.jsx("mark",{className:"bg-yellow-200 dark:bg-yellow-800 px-1 rounded",children:m},c):m)};return e.jsxs(B,{className:"cursor-pointer hover:shadow-md transition-shadow duration-200",onClick:()=>o(t),children:[e.jsxs(I,{className:"pb-3",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.item.type==="directory"?e.jsx(E,{className:"h-4 w-4 text-blue-500"}):e.jsx(L,{className:"h-4 w-4 text-green-500"}),e.jsx(H,{variant:"outline",className:"text-xs",children:t.categoryTitle}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Score: ",t.relevanceScore]})]})}),e.jsx(T,{className:"text-xl mb-2",children:t.item.title?x(t.item.title,n):"Untitled"}),e.jsx(k,{children:t.item.description&&x(t.item.description,n)})]}),e.jsxs(A,{className:"pt-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm text-muted-foreground mb-4",children:[t.item.author&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(O,{className:"h-3 w-3"}),e.jsx("span",{children:x(t.item.author,n)})]}),(t.item.date||t.item.createdOn)&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(q,{className:"h-3 w-3"}),e.jsx("span",{children:t.item.date||t.item.createdOn})]})]}),t.item.tags&&t.item.tags.length>0&&e.jsx(_,{tags:t.item.tags,maxTags:4}),t.path.length>1&&e.jsxs("div",{className:"mt-3 text-xs text-muted-foreground",children:["Path: ",t.path.join(" > ")]})]})]})},G=({searchQuery:t,results:n,onResultClick:s})=>e.jsxs("div",{className:"space-y-6",children:[t.trim()&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:[n.length," result",n.length!==1?"s":"",' for "',t,'"']}),n.map((o,x)=>e.jsx(M,{result:o,searchQuery:t,index:x,onClick:s},`${o.categoryId}-${o.item.id}`)),t.trim()&&n.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsxs("p",{className:"text-muted-foreground text-lg",children:['No articles found for "',t,'"']}),e.jsx("p",{className:"text-muted-foreground text-sm mt-2",children:"Try different keywords or browse categories"})]})]}),J=(t,n)=>{const s=n.toLowerCase(),o=s.split(/\s+/).filter(l=>l.length>0);return t.map(l=>{let a=0;const r=l.item,h=(r==null?void 0:r.title)||"";h.toLowerCase().includes(s)&&(a+=15),o.forEach(i=>{h.toLowerCase().includes(i)&&(a+=8)});const m=(r==null?void 0:r.description)||"";m.toLowerCase().includes(s)&&(a+=12),o.forEach(i=>{m.toLowerCase().includes(i)&&(a+=6)}),r.type==="file"&&r.tags&&Array.isArray(r.tags)&&r.tags.forEach(i=>{const f=(i||"").toLowerCase();f===s?a+=20:f.includes(s)&&(a+=10),o.forEach(j=>{f===j?a+=15:f.includes(j)&&(a+=5)})});const c=(r==null?void 0:r.author)||"";c.toLowerCase().includes(s)&&(a+=8),o.forEach(i=>{c.toLowerCase().includes(i)&&(a+=4)}),r.type==="file"&&r.references&&Array.isArray(r.references)&&r.references.forEach(i=>{const f=(i.title||"").toLowerCase();f.includes(s)&&(a+=6),o.forEach(u=>{f.includes(u)&&(a+=3)}),(i.authors||(i.author?[i.author]:[])).forEach(u=>{const y=(u||"").toLowerCase();y.includes(s)&&(a+=5),o.forEach(v=>{y.includes(v)&&(a+=2)})});const g=(i.publisher||"").toLowerCase();g.includes(s)&&(a+=4),o.forEach(u=>{g.includes(u)&&(a+=2)})});const d=l.categoryTitle||"";return d.toLowerCase().includes(s)&&(a+=5),o.forEach(i=>{d.toLowerCase().includes(i)&&(a+=2)}),{...l,relevanceScore:a}}).filter(l=>l.relevanceScore>0).sort((l,a)=>a.relevanceScore-l.relevanceScore)},K=()=>{const[t,n]=p.useState(null),[s,o]=p.useState([]),[x,l]=p.useState(!0);return p.useEffect(()=>{(async()=>{try{l(!0);const h=await N.fetchBlogsData();n(h);const m=[];for(const c of h.categories)if(c.indexUrl)try{const d=await N.fetchNestedBlogIndex(c.indexUrl),i=(f,j=[])=>{f.forEach(g=>{const u=[...j,g.title||""];m.push({item:g,categoryId:c.id,categoryTitle:c.title,path:u,relevanceScore:0}),g.type==="directory"&&g.children&&i(g.children,u)})};d.children&&i(d.children)}catch(d){console.error(`Failed to load nested index for ${c.id}:`,d)}else c.children&&c.children.forEach(d=>{const i={id:d.id,type:"file",path:d.path||d.contentPath||"",title:d.title||"",description:d.description,date:d.date};m.push({item:i,categoryId:c.id,categoryTitle:c.title,path:[d.title||""],relevanceScore:0})});o(m)}catch(h){console.error("Failed to load blogs data:",h)}finally{l(!1)}})()},[]),{searchResults:p.useMemo(()=>r=>!r.trim()||s.length===0?[]:J(s,r),[s]),allBlogItems:s,isLoading:x}},Z=()=>{const[t,n]=R();w();const[s,o]=p.useState(t.get("q")||""),{searchResults:x,allBlogItems:l}=K();p.useEffect(()=>{s.trim()?n({q:s}):n({})},[s,n]);const a=h=>{const m=N.findItemPath(l.filter(c=>c.categoryId===h.categoryId).map(c=>c.item),h.item);if(m){const c=m.join("/"),d=`/blogs/${h.categoryId}/${c}`;window.open(d,"_blank")}else window.open(`/blogs/${h.categoryId}`,"_blank")},r=x(s);return e.jsx(P,{children:e.jsxs($.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.5},className:"min-h-screen bg-background text-foreground",children:[e.jsx(F,{}),e.jsx("main",{className:"pt-[120px] pb-20",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4",children:[e.jsx(z,{searchQuery:s,onSearchChange:o}),e.jsx(G,{searchQuery:s,results:r,onResultClick:a})]})}),e.jsx(D,{})]})})};export{Z as default};
