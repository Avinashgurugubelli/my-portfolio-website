import{k as N,u as v,r as a,l as I,j as e,T as y,A as B,m as P,N as S,B as k,n as w,o as C,p as F,i as A}from"./index-C_Iv52PG.js";import{u as E}from"./index-DV35r4ug.js";import{B as h}from"./blogService-DmIQvtbX.js";import{M as L,B as T,a as U,E as R}from"./MobileBlogMenu-KKXSjNA0.js";import{A as $}from"./calendar-BwCt0o1g.js";import"./TagsDisplay-CR41PKUs.js";const J=()=>{const{categoryId:m,"*":o}=N(),j=v(),[x,r]=a.useState(null),[g,c]=a.useState(""),[i,u]=a.useState([]),l=I.categories.find(s=>s.id===m),{data:d,isLoading:b}=E({queryKey:["blogIndex",l==null?void 0:l.indexUrl],queryFn:()=>h.fetchNestedBlogIndex(l.indexUrl),enabled:!!(l!=null&&l.indexUrl),staleTime:1e3*60*60}),f=s=>{for(const t of s){if(t.type==="file")return t;if(t.type==="directory"&&t.children){const n=f(t.children);if(n)return n}}return null};a.useEffect(()=>{if(console.log("Setting up blog items. NestedIndex:",d,"Category:",l),d)u(d.children||[]);else if(l!=null&&l.children){const s=l.children.map(t=>({id:t.id,type:"file",path:t.path||t.contentPath||"",title:t.title,description:t.description,date:t.date}));u(s)}},[d,l]),a.useEffect(()=>{if(console.log("Auto-selecting first article. BlogItems length:",i.length,"WildcardPath:",o),i.length>0&&!o){const s=f(i);console.log("First file found:",s),s&&(r(s),c(s.type==="file"?s.path:s.id))}},[i,o]),a.useEffect(()=>{if(console.log("Handling direct URL access. WildcardPath:",o,"BlogItems length:",i.length),o&&i.length>0){const s=o.split("/").filter(Boolean);console.log("Path segments for direct access:",s);const t=h.findBlogItemByPath(i,s);if(console.log("Found item for direct URL:",t),t)r(t),c(t.type==="file"?t.path:t.id);else{console.log("Item not found, falling back to first file");const n=f(i);n&&(r(n),c(n.type==="file"?n.path:n.id))}}},[o,i]);const p=s=>{console.log("Item clicked:",s),r(s),c(s.type==="file"?s.path:s.id);const t=h.findItemPath(i,s);if(console.log("Generated full path for item:",t),t){const n=t.join("/");console.log("Updating URL to:",`/blogs/${m}/${n}`),window.history.replaceState(null,"",`/blogs/${m}/${n}`)}};return l?b?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("p",{children:"Loading blog structure..."})}):e.jsx(y,{children:e.jsx(B,{children:e.jsxs(P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.5},className:"min-h-screen bg-background text-foreground relative",children:[e.jsx(S,{}),e.jsx("main",{className:"pt-[120px]",children:e.jsxs("div",{className:"max-w-7xl mx-auto min-h-[calc(100vh-120px)]",children:[e.jsx("div",{className:"p-4 border-b border-border",children:e.jsxs("div",{className:"flex flex-col gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>j("/blogs"),className:"gap-2",children:[e.jsx($,{className:"h-4 w-4"}),"Back to Articles"]}),i.length>0&&e.jsx(L,{blogItems:i,onItemClick:p,selectedPath:g})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-2xl font-bold mb-2",children:l.title}),e.jsxs(w,{children:[e.jsx(C,{asChild:!0,children:e.jsx("p",{className:"text-muted-foreground line-clamp-3 cursor-help",children:l.description})}),e.jsx(F,{className:"max-w-md",children:e.jsx("p",{children:l.description})})]})]})]})}),i.length>0?e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"hidden lg:block w-80 border-r border-border",children:e.jsx(T,{blogItems:i,onItemClick:p,selectedPath:g})}),e.jsx("div",{className:"flex-1 min-h-[calc(100vh-200px)]",children:x?e.jsx(U,{selectedItem:x}):e.jsx(R,{})})]}):e.jsx("div",{className:"flex items-center justify-center h-[400px]",children:e.jsx("p",{className:"text-muted-foreground",children:"No content available"})})]})}),e.jsx(A,{})]})})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("p",{children:"Category not found"})})};export{J as default};
