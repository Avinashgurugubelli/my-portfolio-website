import{k as I,u as v,r as o,l as y,j as e,A as B,m as P,N as S,B as z,i as k}from"./index-COMSTL8B.js";import{u as w}from"./index-CkUEqKdA.js";import{R as F,a as g,B as R,b as E,c as L,E as U}from"./EmptyBlogState-Cm9p_NIv.js";import{B as h}from"./blogService-CjIYV27M.js";import{A}from"./calendar-B-QMaLpR.js";import"./user-BYf1-yZS.js";const J=()=>{const{categoryId:f,"*":a}=I(),p=v(),[x,r]=o.useState(null),[j,c]=o.useState(""),[l,u]=o.useState([]),i=y.categories.find(s=>s.id===f),{data:d,isLoading:b}=w({queryKey:["blogIndex",i==null?void 0:i.indexUrl],queryFn:()=>h.fetchNestedBlogIndex(i.indexUrl),enabled:!!(i!=null&&i.indexUrl),staleTime:1e3*60*60}),m=s=>{for(const t of s){if(t.type==="file")return t;if(t.type==="directory"&&t.children){const n=m(t.children);if(n)return n}}return null};o.useEffect(()=>{if(console.log("Setting up blog items. NestedIndex:",d,"Category:",i),d)u(d.children||[]);else if(i!=null&&i.children){const s=i.children.map(t=>({id:t.id,type:"file",path:t.path||t.contentPath||"",title:t.title,description:t.description,date:t.date}));u(s)}},[d,i]),o.useEffect(()=>{if(console.log("Auto-selecting first article. BlogItems length:",l.length,"WildcardPath:",a),l.length>0&&!a){const s=m(l);console.log("First file found:",s),s&&(r(s),c(s.type==="file"?s.path:s.id))}},[l,a]),o.useEffect(()=>{if(console.log("Handling direct URL access. WildcardPath:",a,"BlogItems length:",l.length),a&&l.length>0){const s=a.split("/").filter(Boolean);console.log("Path segments for direct access:",s);const t=h.findBlogItemByPath(l,s);if(console.log("Found item for direct URL:",t),t)r(t),c(t.type==="file"?t.path:t.id);else{console.log("Item not found, falling back to first file");const n=m(l);n&&(r(n),c(n.type==="file"?n.path:n.id))}}},[a,l]);const N=s=>{console.log("Item clicked:",s),r(s),c(s.type==="file"?s.path:s.id);const t=h.findItemPath(l,s);if(console.log("Generated full path for item:",t),t){const n=t.join("/");console.log("Updating URL to:",`/blogs/${f}/${n}`),window.history.replaceState(null,"",`/blogs/${f}/${n}`)}};return i?b?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("p",{children:"Loading blog structure..."})}):e.jsx(B,{children:e.jsxs(P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.5},className:"min-h-screen bg-background text-foreground relative",children:[e.jsx(S,{}),e.jsx("main",{className:"pt-[120px]",children:e.jsxs("div",{className:"max-w-7xl mx-auto min-h-[calc(100vh-120px)]",children:[e.jsx("div",{className:"p-4 border-b border-border",children:e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsxs(z,{variant:"outline",size:"sm",onClick:()=>p("/blogs"),className:"gap-2",children:[e.jsx(A,{className:"h-4 w-4"}),"Back to Blogs"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:i.title}),e.jsx("p",{className:"text-muted-foreground",children:i.description})]})]})}),l.length>0?e.jsxs(F,{direction:"horizontal",className:"min-h-[calc(100vh-200px)]",children:[e.jsx(g,{defaultSize:25,minSize:20,maxSize:40,children:e.jsx(R,{blogItems:l,onItemClick:N,selectedPath:j})}),e.jsx(E,{withHandle:!0}),e.jsx(g,{defaultSize:75,children:e.jsx("div",{className:"flex flex-col h-full",children:x?e.jsx(L,{selectedItem:x}):e.jsx(U,{})})})]}):e.jsx("div",{className:"flex items-center justify-center h-[400px]",children:e.jsx("p",{className:"text-muted-foreground",children:"No content available"})})]})}),e.jsx(k,{})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("p",{children:"Category not found"})})};export{J as default};
