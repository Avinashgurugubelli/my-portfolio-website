import{u as v,j as e,B as C,S,I as b,C as I,b as B,F as E,c as L,d as T,e as R,f as A,r as p,a3 as k,A as P,m as $,N as F,i as U}from"./index-CR7pfiew.js";import{A as D,C as O}from"./calendar-DHdOb4GL.js";import{B as q,U as H,T as z}from"./TagsDisplay-dDq8fcOE.js";import{B as N}from"./blogService-B4M-QkIJ.js";const M=({searchQuery:t,onSearchChange:n})=>{const c=v();return e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs(C,{variant:"outline",size:"sm",onClick:()=>c("/blogs"),className:"gap-2",children:[e.jsx(D,{className:"h-4 w-4"}),"Back to Blogs"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Search Blogs"}),e.jsx("p",{className:"text-muted-foreground",children:"Find articles by title, content, tags, or author"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(S,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(b,{type:"text",placeholder:"Search articles...",value:t,onChange:o=>n(o.target.value),className:"pl-10 h-12 text-lg",autoFocus:!0})]})]})},G=({result:t,searchQuery:n,index:c,onClick:o})=>{const x=(l,s)=>{if(!s.trim())return l;const a=new RegExp(`(${s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");return l.split(a).map((h,d)=>a.test(h)?e.jsx("mark",{className:"bg-yellow-200 dark:bg-yellow-800 px-1 rounded",children:h},d):h)};return e.jsxs(I,{className:"cursor-pointer hover:shadow-md transition-shadow duration-200",onClick:()=>o(t),children:[e.jsxs(B,{className:"pb-3",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.item.type==="directory"?e.jsx(E,{className:"h-4 w-4 text-blue-500"}):e.jsx(L,{className:"h-4 w-4 text-green-500"}),e.jsx(q,{variant:"outline",className:"text-xs",children:t.categoryTitle}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Score: ",t.relevanceScore]})]})}),e.jsx(T,{className:"text-xl mb-2",children:t.item.title?x(t.item.title,n):"Untitled"}),e.jsx(R,{children:t.item.description&&x(t.item.description,n)})]}),e.jsxs(A,{className:"pt-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm text-muted-foreground mb-4",children:[t.item.author&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(H,{className:"h-3 w-3"}),e.jsx("span",{children:x(t.item.author,n)})]}),(t.item.date||t.item.createdOn)&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(O,{className:"h-3 w-3"}),e.jsx("span",{children:t.item.date||t.item.createdOn})]})]}),t.item.tags&&t.item.tags.length>0&&e.jsx(z,{tags:t.item.tags,maxTags:4}),t.path.length>1&&e.jsxs("div",{className:"mt-3 text-xs text-muted-foreground",children:["Path: ",t.path.join(" > ")]})]})]})},J=({searchQuery:t,results:n,onResultClick:c})=>e.jsxs("div",{className:"space-y-6",children:[t.trim()&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:[n.length," result",n.length!==1?"s":"",' for "',t,'"']}),n.map((o,x)=>e.jsx(G,{result:o,searchQuery:t,index:x,onClick:c},`${o.categoryId}-${o.item.id}`)),t.trim()&&n.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsxs("p",{className:"text-muted-foreground text-lg",children:['No articles found for "',t,'"']}),e.jsx("p",{className:"text-muted-foreground text-sm mt-2",children:"Try different keywords or browse categories"})]})]}),K=(t,n)=>{const c=n.toLowerCase(),o=c.split(/\s+/).filter(l=>l.length>0);return t.map(l=>{let s=0;const a=l.item,g=(a==null?void 0:a.title)||"";g.toLowerCase().includes(c)&&(s+=15),o.forEach(r=>{g.toLowerCase().includes(r)&&(s+=8)});const h=(a==null?void 0:a.description)||"";h.toLowerCase().includes(c)&&(s+=12),o.forEach(r=>{h.toLowerCase().includes(r)&&(s+=6)}),a.type==="file"&&a.tags&&Array.isArray(a.tags)&&a.tags.forEach(r=>{const m=(r||"").toLowerCase();m===c?s+=20:m.includes(c)&&(s+=10),o.forEach(j=>{m===j?s+=15:m.includes(j)&&(s+=5)})});const d=(a==null?void 0:a.author)||"";d.toLowerCase().includes(c)&&(s+=8),o.forEach(r=>{d.toLowerCase().includes(r)&&(s+=4)}),a.type==="file"&&a.references&&Array.isArray(a.references)&&a.references.forEach(r=>{const m=(r.title||"").toLowerCase();m.includes(c)&&(s+=6),o.forEach(u=>{m.includes(u)&&(s+=3)}),(r.authors||(r.author?[r.author]:[])).forEach(u=>{const y=(u||"").toLowerCase();y.includes(c)&&(s+=5),o.forEach(w=>{y.includes(w)&&(s+=2)})});const f=(r.publisher||"").toLowerCase();f.includes(c)&&(s+=4),o.forEach(u=>{f.includes(u)&&(s+=2)})});const i=l.categoryTitle||"";return i.toLowerCase().includes(c)&&(s+=5),o.forEach(r=>{i.toLowerCase().includes(r)&&(s+=2)}),{...l,relevanceScore:s}}).filter(l=>l.relevanceScore>0).sort((l,s)=>s.relevanceScore-l.relevanceScore)},V=()=>{const[t,n]=p.useState(null),[c,o]=p.useState([]),[x,l]=p.useState(!0);return p.useEffect(()=>{(async()=>{try{l(!0);const g=await N.fetchBlogsData();n(g);const h=[];for(const d of g.categories)if(d.indexUrl)try{const i=await N.fetchNestedBlogIndex(d.indexUrl),r=(m,j=[])=>{m.forEach(f=>{const u=[...j,f.title||""];h.push({item:f,categoryId:d.id,categoryTitle:d.title,path:u,relevanceScore:0}),f.type==="directory"&&f.children&&r(f.children,u)})};i.children&&r(i.children)}catch(i){console.error(`Failed to load nested index for ${d.id}:`,i)}else d.children&&d.children.forEach(i=>{const r={id:i.id,type:"file",path:i.path||i.contentPath||"",title:i.title||"",description:i.description,date:i.date};h.push({item:r,categoryId:d.id,categoryTitle:d.title,path:[i.title||""],relevanceScore:0})});o(h)}catch(g){console.error("Failed to load blogs data:",g)}finally{l(!1)}})()},[]),{searchResults:p.useMemo(()=>a=>!a.trim()||c.length===0?[]:K(c,a),[c]),allBlogItems:c,isLoading:x}},_=()=>{const[t,n]=k(),c=v(),[o,x]=p.useState(t.get("q")||""),{searchResults:l,allBlogItems:s}=V();p.useEffect(()=>{o.trim()?n({q:o}):n({})},[o,n]);const a=h=>{const d=s.filter(r=>r.categoryId===h.categoryId),i=N.findItemPath(d.map(r=>r.item),h.item);if(i&&i.length>0){const r=i.join("/"),m=`/blogs/${h.categoryId}/${r}`;console.log("Opening URL:",m),c(m)}else c(`/blogs/${h.categoryId}`)},g=l(o);return e.jsx(P,{children:e.jsxs($.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.5},className:"min-h-screen bg-background text-foreground",children:[e.jsx(F,{}),e.jsx("main",{className:"pt-[120px] pb-20",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4",children:[e.jsx(M,{searchQuery:o,onSearchChange:x}),e.jsx(J,{searchQuery:o,results:g,onResultClick:a})]})}),e.jsx(U,{})]})})};export{_ as default};
